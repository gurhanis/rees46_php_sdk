<?php
/**
 * User: noff
 * Date: 22/07/14
 * Time: 23:22

 * This is an example of mass export orders to REES46 procedure.
 *
 * Assumes you have tables in database:
 * orders:
 *   id:integer
 *   user_id:integer
 *   total_sum:integer
 *   created_at:datetime
 * order_items:
 *   order_id:integer
 *   item_id:integer
 *   price:integer
 *   amount:integer
 * items:
 *   id:integer
 *   price:integer
 *   category_id:integer
 *   is_available:boolean
 *
 */

// Edit these parameters according to your shop credentials
//define('SHOP_ID', 'b6ef5e0003904ba8245eb7aac0c286');
//define('SHOP_SECRET', '14fd926018b405cbb18c24b6724a5ad8');

// Here prepare your orders data from your database.
// In this example we just prepare array of data instead of database data.
// So you need to change this code according your shop architecture.
$orders = array(
	array(
		'id' => 'order3',
		'user_id' => 334,
		'date' => 1406057494,
		'items' => array(
			array(
				'id' => 105,
				'price' => 3400,
				'category_uniqid' => 14,
				'is_available' => 1,
				'amount' => 2
			),
			array(
				'id' => 106,
				'price' => 3100,
				'category_uniqid' => 19,
				'is_available' => 1,
				'amount' => 1
			)
		)
	),
	array(
		'id' => 'order4',
		'user_id' => 18,
		'date' => 1406057499,
		'items' => array(
			array(
				'id' => 107,
				'price' => 3400,
				'category_uniqid' => 14,
				'is_available' => 1,
				'amount' => 1
			)
		)
	)
);



// $str = '{"shop_id":"3519c7e25292c23664766e6050e2d1","shop_secret":"086dcc7eb9886e18de0314e6c2006dcf","orders":[{"id":"184282","user_id":"38176","date":"1434100285","items":[{"id":"91055","price":"66","name":"GALEREJA 445","url":"http:\/\/mirtrik.by\/product\/91055","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/galereja\/445-bir.jpg","categories":"6,46,47,54","attributes":"{\"brand\":\"GALEREJA\",\"color\":\"\\u0441 \\u0431\\u0438\\u0440\\u044e\\u0437\\u043e\\u0432\\u044b\\u043c\\u0438 \\u0446\\u0432\\u0435\\u0442\\u0430\\u043c\\u0438\",\"sizes\":[\"r56\"],\"gender\":\"f\"}"}]},{"id":"189483","user_id":"25425","date":"1433838337","items":[{"id":"69376","price":"34","name":"Devita 720","url":"http:\/\/mirtrik.by\/product\/69376","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/devito\/720-cherno-goluboy-imis.jpg","categories":"5,37,46,47","attributes":"{\"brand\":\"Devita\",\"color\":\"\\u0447\\u0435\\u0440\\u043d\\u043e-\\u0433\\u043e\\u043b\\u0443\\u0431\\u043e\\u0439\",\"sizes\":[\"r46\"],\"gender\":\"f\"}"},{"id":"69401","price":"34","name":"Devita 720","url":"http:\/\/mirtrik.by\/product\/69401","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/devito\/720-cherno-zelenyys.jpg","categories":"5,37,46,47","attributes":"{\"brand\":\"Devita\",\"color\":\"\\u0447\\u0435\\u0440\\u043d\\u043e-\\u0437\\u0435\\u043b\\u0435\\u043d\\u044b\\u0439\",\"sizes\":[\"r46\"],\"gender\":\"f\"}"},{"id":"83959","price":"34","name":"Devita 733","url":"http:\/\/mirtrik.by\/product\/83959","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/devito\/733-belyys.jpg","categories":"5,37,46,47","attributes":"{\"brand\":\"Devita\",\"color\":\"\\u0431\\u0435\\u043b\\u044b\\u0439\",\"sizes\":[\"r44\",\"r46\"],\"gender\":\"f\"}"},{"id":"84395","price":"37","name":"Devita 217","url":"http:\/\/mirtrik.by\/product\/84395","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/devito\/217-ottenok-rozovogos.jpg","categories":"5,2,46,47","attributes":"{\"brand\":\"Devita\",\"color\":\"\\u043e\\u0442\\u0442\\u0435\\u043d\\u043e\\u043a-\\u0440\\u043e\\u0437\\u043e\\u0432\\u043e\\u0433\\u043e\",\"sizes\":[\"r44\"],\"type\":\"upper\",\"gender\":\"f\"}"},{"id":"87001","price":"34","name":"Devita 228","url":"http:\/\/mirtrik.by\/product\/87001","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/devito\/228-zheltyys3.jpg","categories":"5,2,46,47","attributes":"{\"brand\":\"Devita\",\"color\":\"\\u0436\\u0435\\u043b\\u0442\\u044b\\u0439\",\"sizes\":[\"r44\"],\"type\":\"upper\",\"gender\":\"f\"}"},{"id":"87303","price":"28","name":"Devita 218","url":"http:\/\/mirtrik.by\/product\/87303","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/devito\/218-temnyys2.jpg","categories":"5,35,46,47","attributes":"{\"brand\":\"Devita\",\"color\":\"\\u0442\\u0435\\u043c\\u043d\\u044b\\u0435-\\u0442\\u043e\\u043d\\u0430\",\"sizes\":[\"r44\"],\"type\":\"upper\",\"gender\":\"f\"}"},{"id":"88727","price":"42","name":"Devita 244","url":"http:\/\/mirtrik.by\/product\/88727","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/devito\/244-svetlye-tonas_1.jpg","categories":"6,46,47,54","attributes":"{\"brand\":\"Devita\",\"color\":\"\\u0441\\u0432\\u0435\\u0442\\u043b\\u044b\\u0435-\\u0442\\u043e\\u043d\\u0430+\\u0441\\u0438\\u043d\\u0438\\u0439\",\"sizes\":[\"r44\"],\"gender\":\"f\"}"},{"id":"90517","price":"35","name":"Devita 246","url":"http:\/\/mirtrik.by\/product\/90517","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/devito\/246-krasno-serye-tona.jpg","categories":"6,46,47,54","attributes":"{\"brand\":\"Devita\",\"color\":\"\\u043a\\u0440\\u0430\\u0441\\u043d\\u043e-\\u0441\\u0435\\u0440\\u044b\\u0435-\\u0442\\u043e\\u043d\\u0430247\",\"sizes\":[\"r44\"],\"gender\":\"f\"}"},{"id":"72363","price":"40","name":"Elletto 1321","url":"http:\/\/mirtrik.by\/product\/72363","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/eletto\/1321-temno-siniys.jpg","categories":"5,2,46,47","attributes":"{\"brand\":\"Elletto\",\"color\":\"\\u0442\\u0435\\u043c\\u043d\\u043e-\\u0441\\u0438\\u043d\\u0438\\u0439\",\"sizes\":[\"r56\"],\"type\":\"upper\",\"gender\":\"f\"}"},{"id":"72364","price":"40","name":"Elletto 1322","url":"http:\/\/mirtrik.by\/product\/72364","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/eletto\/1322-rozovo-bezhevye-tonas.jpg","categories":"5,2,46,47","attributes":"{\"brand\":\"Elletto\",\"color\":\"\\u0440\\u043e\\u0437\\u043e\\u0432\\u043e-\\u0431\\u0435\\u0436\\u0435\\u0432\\u044b\\u0439 \\u0442\\u043e\\u043d\\u0430\",\"sizes\":[\"r54\"],\"type\":\"upper\",\"gender\":\"f\"}"},{"id":"88932","price":"46","name":"Faufilure 147\u0421","url":"http:\/\/mirtrik.by\/product\/88932","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/faufilure\/s147-fuk1.jpg","categories":"6,2,46,47","attributes":"{\"brand\":\"Faufilure\",\"color\":\"\\u0444\\u0443\\u043a\\u0441\\u0438\\u044f\",\"sizes\":[\"r54\"],\"type\":\"upper\",\"gender\":\"f\"}"},{"id":"88681","price":"45","name":"LeNata 21565","url":"http:\/\/mirtrik.by\/product\/88681","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/lenata\/001.jpg","categories":"6,46,47,54","attributes":"{\"brand\":\"LeNata\",\"color\":\"\\u043a\\u043e\\u0440\\u0438\\u0447\\u043d\\u0435\\u0432\\u044b\\u0439\",\"sizes\":[\"r44\"],\"gender\":\"f\"}"},{"id":"79166","price":"46","name":"Mira Fashion 3767","url":"http:\/\/mirtrik.by\/product\/79166","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/mirafashion\/3767-tyomno-shok1.jpg","categories":"5,39,2,46,47","attributes":"{\"brand\":\"Mira Fashion\",\"color\":\"\\u0447\\u0451\\u0440\\u043d\\u044b\\u0439 \\u0441 \\u0437\\u043e\\u043b\\u043e\\u0442\\u0438\\u0441\\u0442\\u044b\\u043c\",\"sizes\":[\"r56\"],\"type\":\"upper\",\"gender\":\"f\"}"},{"id":"84575","price":"41","name":"Mira Fashion 3823","url":"http:\/\/mirtrik.by\/product\/84575","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/mirafashion\/3823-0.jpg","categories":"5,6,39,2,46,47","attributes":"{\"brand\":\"Mira Fashion\",\"color\":\"\\u0446\\u0432\\u0435\\u0442\\u044b\",\"sizes\":[\"r54\"],\"type\":\"upper\",\"gender\":\"f\"}"},{"id":"77951","price":"41","name":"Panda 306380","url":"http:\/\/mirtrik.by\/product\/77951","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/panda\/306380-48-56.jpg","categories":"5,39,2,46,47","attributes":"{\"brand\":\"Panda\",\"color\":\"\\u0447\\u0435\\u0440\\u043d\\u044b\\u0439 \\u0441 \\u0437\\u043e\\u043b\\u043e\\u0442\\u043e\\u043c\",\"sizes\":[\"r52\",\"r54\"],\"type\":\"upper\",\"gender\":\"f\"}"},{"id":"87239","price":"56","name":"Panda 323220","url":"http:\/\/mirtrik.by\/product\/87239","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/panda\/323220-svetlye-tonas.jpg","categories":"6,1,28,46,47","attributes":"{\"brand\":\"Panda\",\"color\":\"\\u0431\\u0435\\u0436\\u0435\\u0432\\u043e-\\u0431\\u0435\\u043b\\u044b\\u0435-\\u0442\\u043e\\u043d\\u0430\",\"sizes\":[\"r56\"],\"gender\":\"f\"}"},{"id":"69774","price":"28","name":"Prestige 2234","url":"http:\/\/mirtrik.by\/product\/69774","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/prestige\/2234-cvetys.jpg","categories":"5,1,27,46,47","attributes":"{\"brand\":\"Prestige\",\"color\":\"\\u0446\\u0432\\u0435\\u0442\\u044b\",\"sizes\":[\"r44\",\"r46\"],\"gender\":\"f\"}"},{"id":"83075","price":"44","name":"Prestige 2503","url":"http:\/\/mirtrik.by\/product\/83075","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/prestige\/2503-zheltyys.jpg","categories":"5,2,46,47","attributes":"{\"brand\":\"Prestige\",\"color\":\"\\u0436\\u0435\\u043b\\u0442\\u044b\\u0439\",\"sizes\":[\"r44\"],\"type\":\"upper\",\"gender\":\"f\"}"},{"id":"86537","price":"46","name":"Prestige 2520","url":"http:\/\/mirtrik.by\/product\/86537","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/prestige\/2520-goluboys.jpg","categories":"5,2,46,47","attributes":"{\"brand\":\"Prestige\",\"color\":\"\\u0433\\u043e\\u043b\\u0443\\u0431\\u043e\\u0439\",\"sizes\":[\"r56\"],\"type\":\"upper\",\"gender\":\"f\"}"},{"id":"86538","price":"46","name":"Prestige 2520","url":"http:\/\/mirtrik.by\/product\/86538","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/prestige\/2520-chernyys.jpg","categories":"5,2,46,47","attributes":"{\"brand\":\"Prestige\",\"color\":\"\\u0447\\u0435\\u0440\\u043d\\u044b\\u0439\",\"sizes\":[\"r56\"],\"type\":\"upper\",\"gender\":\"f\"}"},{"id":"86665","price":"46","name":"Prestige 2529","url":"http:\/\/mirtrik.by\/product\/86665","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/prestige\/2529-biryuzovye-tonas.jpg","categories":"5,1,27,46,47","attributes":"{\"brand\":\"Prestige\",\"color\":\"\\u0431\\u0438\\u0440\\u044e\\u0437\\u043e\\u0432\\u044b\\u0435-\\u0442\\u043e\\u043d\\u0430\",\"sizes\":[\"r58\"],\"gender\":\"f\"}"},{"id":"86785","price":"50","name":"Prestige 2544","url":"http:\/\/mirtrik.by\/product\/86785","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/prestige\/2544-cherno-zelenyys.jpg","categories":"5,2,46,47","attributes":"{\"brand\":\"Prestige\",\"color\":\"\\u0447\\u0435\\u0440\\u043d\\u043e-\\u0437\\u0435\\u043b\\u0435\\u043d\\u044b\\u0439\",\"sizes\":[\"r54\"],\"type\":\"upper\",\"gender\":\"f\"}"},{"id":"87804","price":"44","name":"Prestige 2487","url":"http:\/\/mirtrik.by\/product\/87804","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/prestige\/2487-belo-zelenye-tonas.jpg","categories":"6,2,46,47","attributes":"{\"brand\":\"Prestige\",\"color\":\"\\u0431\\u0435\\u043b\\u043e-\\u0437\\u0435\\u043b\\u0435\\u043d\\u044b\\u0435-\\u0442\\u043e\\u043d\\u0430\",\"sizes\":[\"r56\"],\"type\":\"upper\",\"gender\":\"f\"}"},{"id":"53910","price":"25","name":"Runella 111","url":"http:\/\/mirtrik.by\/product\/53910","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/runella\/111-bordovyy1s.jpg","categories":"5,6,39,2,46,47","attributes":"{\"brand\":\"Runella\",\"color\":\"\\u0431\\u043e\\u0440\\u0434\\u043e\\u0432\\u044b\\u0439\",\"sizes\":[\"r60\"],\"type\":\"upper\",\"gender\":\"f\"}"},{"id":"62053","price":"19","name":"Runella 152","url":"http:\/\/mirtrik.by\/product\/62053","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/runella\/152-chyorno-zelyonyy-s.jpg","categories":"6,3,46,47","attributes":"{\"brand\":\"Runella\",\"color\":\"\\u0447\\u0451\\u0440\\u043d\\u043e-\\u0437\\u0435\\u043b\\u0451\\u043d\\u044b\\u0439\",\"sizes\":[\"r54\",\"r62\"],\"type\":\"upper\",\"gender\":\"f\"}"},{"id":"82763","price":"39","name":"Vesnaletto 797\u042e","url":"http:\/\/mirtrik.by\/product\/82763","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/vesnaletto\/797yu.jpg","categories":"5,39,1,27,46,47","attributes":"{\"brand\":\"Vesnaletto\",\"color\":\"\\u0447\\u0435\\u0440\\u043d\\u044b\\u0439 \\u0441 \\u0431\\u0435\\u043b\\u044b\\u043c\",\"sizes\":[\"r44\"],\"gender\":\"f\"}"},{"id":"83414","price":"44","name":"Vesnaletto 847\u043a","url":"http:\/\/mirtrik.by\/product\/83414","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/vesnaletto\/847k.jpg","categories":"6,1,28,46,47","attributes":"{\"brand\":\"Vesnaletto\",\"color\":\"\\u0431\\u0435\\u043b\\u044b\\u0439\",\"sizes\":[\"r44\"],\"gender\":\"f\"}"},{"id":"85277","price":"41","name":"Vesnaletto 883","url":"http:\/\/mirtrik.by\/product\/85277","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/vesnaletto\/883.jpg","categories":"6,1,27,46,47","attributes":"{\"brand\":\"Vesnaletto\",\"color\":\"\\u0441\\u0432\\u0435\\u0442\\u043b\\u044b\\u0435 \\u0442\\u043e\\u043d\\u0430\",\"sizes\":[\"r44\"],\"gender\":\"f\"}"},{"id":"85295","price":"54","name":"Vesnaletto 892","url":"http:\/\/mirtrik.by\/product\/85295","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/vesnaletto\/892.jpg","categories":"6,1,27,46,47","attributes":"{\"brand\":\"Vesnaletto\",\"color\":\"\\u0431\\u0435\\u0436\\u0435\\u0432\\u044b\\u0439 \\u0441 \\u0431\\u0435\\u043b\\u044b\\u043c\",\"sizes\":[\"r44\"],\"gender\":\"f\"}"},{"id":"85304","price":"43","name":"Vesnaletto 886","url":"http:\/\/mirtrik.by\/product\/85304","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/vesnaletto\/886.jpg","categories":"6,1,27,46,47","attributes":"{\"brand\":\"Vesnaletto\",\"color\":\"\\u0447\\u0435\\u0440\\u043d\\u044b\\u0439 \\u0441 \\u0431\\u0435\\u043b\\u044b\\u043c\",\"sizes\":[\"r44\"],\"gender\":\"f\"}"},{"id":"89725","price":"54","name":"Vesnaletto 900","url":"http:\/\/mirtrik.by\/product\/89725","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/vesnaletto\/900-cherno-belye-tona.jpg","categories":"6,46,47,54","attributes":"{\"brand\":\"Vesnaletto\",\"color\":\"\\u0431\\u0435\\u043b\\u043e-\\u0447\\u0435\\u0440\\u043d\\u044b\\u0439\",\"sizes\":[\"r44\"],\"gender\":\"f\"}"},{"id":"88645","price":"41","name":"\u0414\u0438\u0430\u043c\u0430\u043d\u0442 990","url":"http:\/\/mirtrik.by\/product\/88645","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/diamant\/m-99048-581.jpg","categories":"6,2,46,47","attributes":"{\"brand\":\"\\u0414\\u0438\\u0430\\u043c\\u0430\\u043d\\u0442\",\"color\":\"\\u0441\\u0438\\u043d\\u0435-\\u0431\\u0435\\u043b\\u044b\\u0439\",\"sizes\":[\"r56\"],\"type\":\"upper\",\"gender\":\"f\"}"},{"id":"89537","price":"37","name":"\u041d\u043e\u0432\u0435\u043b\u043b\u0430 \u0428\u0430\u0440\u043c 2527","url":"http:\/\/mirtrik.by\/product\/89537","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/novella-sharm\/2527-cvety.jpg","categories":"6,2,46,47","attributes":"{\"brand\":\"\\u041d\\u043e\\u0432\\u0435\\u043b\\u043b\\u0430 \\u0428\\u0430\\u0440\\u043c\",\"color\":\"\\u0446\\u0432\\u0435\\u0442\\u044b\",\"sizes\":[\"r54\"],\"type\":\"upper\",\"gender\":\"f\"}"},{"id":"85965","price":"41","name":"\u041e\u0440\u0445\u0438\u0434\u0435\u044f \u041b\u044e\u043a\u0441 635","url":"http:\/\/mirtrik.by\/product\/85965","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/orchidea\/635.jpg","categories":"6,39,2,46,47","attributes":"{\"brand\":\"\\u041e\\u0440\\u0445\\u0438\\u0434\\u0435\\u044f \\u041b\\u044e\\u043a\\u0441\",\"color\":\"\\u0422\\u0435\\u043c\\u043d\\u043e-\\u0441\\u0438\\u043d\\u0438\\u0439\",\"sizes\":[\"r62\"],\"type\":\"upper\",\"gender\":\"f\"}"},{"id":"69001","price":"28","name":"\u0422\u0410\u0438\u0415\u0420 414","url":"http:\/\/mirtrik.by\/product\/69001","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/taier\/414-52-56-2014_08_05_taier_0457-copy.jpg","categories":"5,2,46,47","attributes":"{\"brand\":\"\\u0422\\u0410\\u0438\\u0415\\u0420\",\"color\":\"\\u0441\\u0438\\u043d\\u0438\\u0439\",\"sizes\":[\"r54\"],\"type\":\"upper\",\"gender\":\"f\"}"},{"id":"85553","price":"27","name":"\u042e\u0420\u0421 13-345","url":"http:\/\/mirtrik.by\/product\/85553","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/urs\/13-345-salroz.jpg","categories":"6,2,46,47","attributes":"{\"brand\":\"\\u042e\\u0420\\u0421\",\"color\":\"\\u0441\\u0430\\u043b\\u0430\\u0442\\u043e\\u0432\\u043e-\\u0440\\u043e\\u0437\\u043e\\u0432\\u044b\\u0439\",\"sizes\":[\"r44\"],\"type\":\"upper\",\"gender\":\"f\"}"}]},{"id":"197762","user_id":"17953","date":"1433760572","items":[{"id":"87250","price":"30","name":"Djerza 061","url":"http:\/\/mirtrik.by\/product\/87250","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/djerza\/061-rozovyy.jpg","categories":"6,3,46,47","attributes":"{\"brand\":\"Djerza\",\"color\":\"\\u0440\\u043e\\u0437\\u043e\\u0432\\u044b\\u0439\",\"sizes\":[\"r56\"],\"type\":\"upper\",\"gender\":\"f\"}"},{"id":"88182","price":"45","name":"Djerza 1337","url":"http:\/\/mirtrik.by\/product\/88182","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/djerza\/1337-bezhevyy-s-devushkoy.jpg","categories":"6,2,46,47","attributes":"{\"brand\":\"Djerza\",\"color\":\"\\u0431\\u0435\\u0436\\u0435\\u0432\\u044b\\u0439 \\u0441 \\u0434\\u0435\\u0432\\u0443\\u0448\\u043a\\u043e\\u0439\",\"sizes\":[\"r52\"],\"type\":\"upper\",\"gender\":\"f\"}"},{"id":"85755","price":"27","name":"GALEREJA 430","url":"http:\/\/mirtrik.by\/product\/85755","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/galereja\/430-1.jpg","categories":"6,3,46,47","attributes":"{\"brand\":\"GALEREJA\",\"color\":\"\\u0442\\u0435\\u043c\\u043d\\u043e-\\u0441\\u0438\\u043d\\u0438\\u0439, \\u0431\\u0435\\u043b\\u044b\\u0435 \\u0446\\u0432\\u0435\\u0442\\u044b\",\"sizes\":[\"r62\"],\"type\":\"upper\",\"gender\":\"f\"}"},{"id":"90371","price":"26","name":"JaneVisson 3085","url":"http:\/\/mirtrik.by\/product\/90371","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/janevisson\/3085-cherno-roz.jpg","categories":"5,3,46,47","attributes":"{\"brand\":\"JaneVisson\",\"color\":\"\\u0447\\u0435\\u0440\\u043d\\u043e-\\u0440\\u043e\\u0437\\u043e\\u0432\\u044b\\u0439\",\"sizes\":[\"r62\"],\"type\":\"upper\",\"gender\":\"f\"}"},{"id":"88515","price":"29","name":"Matini 4896","url":"http:\/\/mirtrik.by\/product\/88515","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/matini\/4896-fuks1.jpg","categories":"6,3,46,47","attributes":"{\"brand\":\"Matini\",\"color\":\"\\u0444\\u0443\\u043a\\u0441\\u0438\\u044f\",\"sizes\":[\"r62\"],\"type\":\"upper\",\"gender\":\"f\"}"},{"id":"89325","price":"45","name":"Mira Fashion 3893","url":"http:\/\/mirtrik.by\/product\/89325","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/mirafashion\/3893-sin.jpg","categories":"6,2,46,47","attributes":"{\"brand\":\"Mira Fashion\",\"color\":\"\\u0441\\u0438\\u043d\\u0438\\u0439\",\"sizes\":[\"r56\"],\"type\":\"upper\",\"gender\":\"f\"}"},{"id":"57722","price":"40","name":"Runella 135","url":"http:\/\/mirtrik.by\/product\/57722","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/runella\/135-1.jpg","categories":"6,1,27,46,47","attributes":"{\"brand\":\"Runella\",\"color\":\"\\u0442\\u0451\\u043c\\u043d\\u043e-\\u0441\\u0438\\u043d\\u0435-\\u043c\\u043e\\u043b\\u043e\\u0447\\u043d\\u044b\\u0439\",\"sizes\":[\"r52\"],\"gender\":\"f\"}"},{"id":"85000","price":"21","name":"VIA-Mod 189","url":"http:\/\/mirtrik.by\/product\/85000","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/viamod\/189_0.jpg","categories":"5,2,46,47","attributes":"{\"brand\":\"VIA-Mod\",\"color\":\"\\u0442\\u0435\\u043c\\u043d\\u043e - \\u0440\\u043e\\u0437\\u043e\\u0432\\u044b\\u0439\",\"sizes\":[\"r62\"],\"type\":\"upper\",\"gender\":\"f\"}"},{"id":"78285","price":"34","name":"\u0422\u0410\u0438\u0415\u0420 431","url":"http:\/\/mirtrik.by\/product\/78285","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/taier\/431-66.jpg","categories":"39,2,46,47","attributes":"{\"brand\":\"\\u0422\\u0410\\u0438\\u0415\\u0420\",\"color\":\"\\u0441\\u0438\\u043d\\u0438\\u0439\",\"sizes\":[\"r56\"],\"type\":\"upper\",\"gender\":\"f\"}"}]},{"id":"206329","user_id":"19899","date":"1434017857","items":[{"id":"60283","price":"40","name":"Axxa 25920","url":"http:\/\/mirtrik.by\/product\/60283","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/axxa\/25920nn1.jpg","categories":"6,46,47,54","attributes":"{\"brand\":\"Axxa\",\"color\":\"\\u0431\\u0435\\u043b\\u043e-\\u0440\\u043e\\u0437\\u043e\\u0432\\u044b\\u0439\",\"sizes\":[\"r62\"],\"gender\":\"f\"}"},{"id":"78517","price":"83","name":"Lady Line 301","url":"http:\/\/mirtrik.by\/product\/78517","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/ladyline\/a301.jpg","categories":"39,2,46,47","attributes":"{\"brand\":\"Lady Line\",\"color\":\"\\u0442\\u0435\\u043c\\u043d\\u043e-\\u0441\\u0438\\u043d\\u0438\\u0439\",\"sizes\":[\"r64\"],\"type\":\"upper\",\"gender\":\"f\"}"},{"id":"87327","price":"62","name":"\u041e\u0440\u0445\u0438\u0434\u0435\u044f \u041b\u044e\u043a\u0441 647","url":"http:\/\/mirtrik.by\/product\/87327","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/orchidea\/647-cve.jpg","categories":"6,2,46,47","attributes":"{\"brand\":\"\\u041e\\u0440\\u0445\\u0438\\u0434\\u0435\\u044f \\u041b\\u044e\\u043a\\u0441\",\"color\":\"\\u0431\\u0435\\u043b\\u044b\\u0439 \\u0441 \\u0446\\u0432\\u0435\\u0442\\u0430\\u043c\\u0438\",\"sizes\":[\"r62\"],\"type\":\"upper\",\"gender\":\"f\"}"},{"id":"62466","price":"85","name":"\u0422\u0410\u0438\u0415\u0420 350","url":"http:\/\/mirtrik.by\/product\/62466","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/taier\/350.jpg","categories":"6,1,27,46,47","attributes":"{\"brand\":\"\\u0422\\u0410\\u0438\\u0415\\u0420\",\"color\":\"\\u0441\\u0435\\u0440\\u044b\\u0439+\\u0433\\u043e\\u043b\\u0443\\u0431\\u043e\\u0439\",\"sizes\":[\"r64\"],\"gender\":\"f\"}"}]},{"id":"210833","user_id":"24874","date":"1434009310","items":[{"id":"89941","price":"31","name":"Alani 160","url":"http:\/\/mirtrik.by\/product\/89941","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/alani\/160-ottenki-tyomnogo.jpg","categories":"6,2,46,47","attributes":"{\"brand\":\"Alani\",\"color\":\"\\u043e\\u0442\\u0442\\u0435\\u043d\\u043a\\u0438 \\u0442\\u0451\\u043c\\u043d\\u043e\\u0433\\u043e\",\"sizes\":[\"r56\"],\"type\":\"upper\",\"gender\":\"f\"}"},{"id":"88887","price":"37","name":"\u042d\u043b\u0442\u0440\u0438\u0433\u0430 01-295","url":"http:\/\/mirtrik.by\/product\/88887","image_url":"http:\/\/mirtrik.by\/files\/mirtrik\/imagecache\/jscrop_bigone\/catalog\/eltriga\/01-295-golubye-tona.jpg","categories":"6,2,46,47","attributes":"{\"brand\":\"\\u042d\\u043b\\u0442\\u0440\\u0438\\u0433\\u0430\",\"color\":\"\\u0433\\u043e\\u043b\\u0443\\u0431\\u044b\\u0435 \\u0442\\u043e\\u043d\\u0430\",\"sizes\":[\"r58\"],\"type\":\"upper\",\"gender\":\"f\"}"}]}]}';
// $orders = json_decode($str, true)["orders"];

define('SHOP_ID', '3519c7e25292c23664766e6050e2d1');
define('SHOP_SECRET', '086dcc7eb9886e18de0314e6c2006dcf');


// ** Prepare CURL object

$ch = curl_init();
curl_setopt($ch, CURLOPT_HEADER, 0);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
curl_setopt($ch, CURLOPT_POST, true);
curl_setopt($ch, CURLOPT_URL, 'http://api.rees46.com/import/orders');
curl_setopt($ch, CURLOPT_HTTPHEADER, array('Content-Type: application/json'));

// Split orders by 1000 per request
$chunks = array_chunk($orders, 1000);

foreach($chunks as $key => $chunk) {
	$data = array(
		'shop_id' => SHOP_ID,
		'shop_secret' => SHOP_SECRET,
		'orders' => $chunk
	);
	$body = json_encode($data);
	curl_setopt($ch, CURLOPT_POSTFIELDS, $body);

	$response = curl_exec($ch);
	$response_info = curl_getinfo($ch);

	if($response_info['http_code'] < 200 || $response_info['http_code'] >= 300) {
		$data_as_string = var_export($data, true);
		$response_as_string = var_export($response_info, true);
		error_log("Error request \n\nData:\n'{$data_as_string}'\n\nResponse Info:\n{$response_as_string}\n\nResponse:\n'{$response_body->message}'");
		exit(1);
	} else {
		echo 'Chunk ' . ($key+1) . ' done. Response: ' . $response . PHP_EOL;
	}

}





// ** Close all connections and clean

curl_close($ch);

echo 'Done.' . PHP_EOL;
